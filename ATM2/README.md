# ATM银行系统 - MVC架构实现

## 项目概述

这是一个基于MVC架构的ATM银行系统，实现了用户管理、账户操作、利率计算和数据持久化等功能。

## 系统架构

### MVC三层结构

1. **模型层 (Model) - User类**
   - 存储用户核心信息
   - 用户名、姓名、性别、密码
   - 账号创建时间
   - 账户余额

2. **控制层 (Controller) - Bank类**
   - 用户注册和登录验证
   - 查询余额：`int queryBalance()`
   - 存钱：`void deposit(int amount)` - 包含金额合法性验证
   - 取钱：`void withdrawl(int amount)` - 包含金额合法性验证和余额检查
   - 密码修改
   - 利率计算和自动更新
   - 数据持久化（使用ObjectOutputStream/ObjectInputStream）

3. **视图层 (View) - ATM类**
   - 向用户呈现菜单
   - 接收用户输入
   - 显示操作结果和错误信息

## 核心功能

### 用户管理
- ✅ 创建新用户（用户名、姓名、性别、密码）
- ✅ 用户登录验证
- ✅ 修改密码
- ✅ 多用户支持（使用HashMap存储）
- ✅ 默认管理员账户（用户名：admin，密码：123456）

### 账户操作
- ✅ 查询余额
- ✅ 存钱（金额合法性验证）
- ✅ 取钱（金额合法性验证 + 余额检查）
- ✅ 实时余额更新

### 利率计算
- ✅ 可配置利率
- ✅ 后台线程自动计算利息
- ✅ 余额实时更新

### 数据持久化
- ✅ 退出系统时自动保存用户数据
- ✅ 启动系统时自动加载用户数据
- ✅ 使用ObjectOutputStream/ObjectInputStream实现序列化

## 菜单结构

### 访客菜单
```
===== 欢迎来到XXX银行的ATM =====
1. 登录
2. 创建新用户
3. 退出系统
```

### 用户菜单
```
您好，X先生/女士！欢迎来到XXX银行的ATM！
当前余额: XXX.XX (利率: X.XXXX%)
1. 存钱
2. 取钱
3. 查询余额
4. 修改密码
5. 退出当前用户
0. 退出系统
```

## 运行方式

### 1. 运行完整ATM系统
```bash
java ATM
```

### 2. 运行演示程序
```bash
java ATMDemo
```

### 3. 运行测试
```bash
java TestRunner
```

## 测试覆盖

### UserTest - 用户模型测试
- ✅ 用户信息存储
- ✅ 性别解析
- ✅ 密码修改
- ✅ 姓名修改
- ✅ 余额操作
- ✅ 性别称谓

### BankTest - 银行控制层测试
- ✅ 存款和取款规则验证
- ✅ 数据持久化
- ✅ 利率计算
- ✅ 默认管理员账户
- ✅ 用户名唯一性
- ✅ 登录验证
- ✅ 密码修改
- ✅ 利率配置
- ✅ 自动利率计算线程
- ✅ 非法金额处理

### ATMTest - ATM视图层测试
- ✅ 登录查询退出流程
- ✅ 用户注册流程
- ✅ 存款流程
- ✅ 取款流程
- ✅ 密码修改流程
- ✅ 非法登录处理
- ✅ 余额不足处理

## 技术特点

1. **线程安全**：所有余额操作使用synchronized保证线程安全
2. **自动利率计算**：后台守护线程定期计算利息
3. **数据持久化**：使用Java序列化机制保存和加载数据
4. **输入验证**：严格的金额和密码验证
5. **错误处理**：完善的异常处理和用户提示
6. **可扩展性**：清晰的MVC架构便于功能扩展

## 文件说明

- `User.java` - 用户模型类
- `Bank.java` - 银行控制类
- `ATM.java` - ATM视图类
- `ATMDemo.java` - 演示程序
- `UserTest.java` - 用户类测试
- `BankTest.java` - 银行类测试
- `ATMTest.java` - ATM类测试
- `TestRunner.java` - 测试运行器
- `atm-users.dat` - 用户数据文件（自动生成）

## 默认账户

- 用户名：`admin`
- 密码：`123456`
- 可以修改密码

## 注意事项

1. 利率计算线程在ATM启动时自动开启，每10秒计算一次
2. 所有用户数据在退出系统时自动保存
3. 金额必须为正整数
4. 取款金额不能超过当前余额
5. 用户名不能重复
